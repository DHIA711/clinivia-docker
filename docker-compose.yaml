version: '3.8'

services:
  sqlserver:
    image: mcr.microsoft.com/mssql/server:2022-latest
    environment:
      SA_PASSWORD: "Passw0rd123"
      ACCEPT_EULA: "Y"
    ports:
      - "1433:1433"
    networks:
      - clinivia-network

  adminer:
    image: adminer
    restart: always
    ports:
      - "8081:8080" # Adminer écoute sur le port 8080 interne, mappé sur 8081 externe pour éviter les conflits
    networks:
      - clinivia-network  

  webapi:
    image: clinivia_backend:latest
    environment:
      - ASPNETCORE_ENVIRONMENT=Docker
      - DOTNET_RUNNING_IN_CONTAINER=true
    ports:
      - "8080:8080" # L'application web écoute sur le port 8080 interne, mappé sur 8080 externe
    depends_on:
      - sqlserver
    networks:
      - clinivia-network

  frontend:
    image: clinivia_frontend:latest
    ports:
      - "90:80" # Le frontend écoute sur le port 80 interne, mappé sur 4200 externe
    depends_on:
      - webapi
    networks:
      - clinivia-network

networks:
  clinivia-network:
